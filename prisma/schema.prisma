
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ApiProvider {
  openAI
  anthropic
  google
  meta
  xAI
  deepSeek
}

enum ApiModel {
  GPT_o1
  GPT_o1_preview
  GPT_o1_mini
  GPT_o3_mini
  GPT_4o
  GPT_4o_mini
  GPT_4_Turbo
  GPT_4
  GPT_3_5_Turbo
  DALL_E
  Claude_3_7_Sonnet
  Claude_3_5_Sonnet
  Claude_3_5_Haiku
  Claude_3_Opus
  Claude_3_Sonnet
  Claude_3_Haiku
  Gemini_1_5_Pro
  Gemini_1_5_Flash
  Gemini_1_0_Pro
  Gemini_2_0_Flash
  Gemini_2_0_Flash_Lite
  Llama_3_2_90b_Vision
  Grok_beta
  Grok_2
  Grok_2_vision
  R1
  V3
}

model User {
  id                    Int         @id @default(autoincrement())
  email                 String      @unique
  name                  String
  password_hash         String?
  oauth                 String?
  oauth_link_token      String?
  reset_password_token  String?
  reset_expiration      DateTime?
  stripe_id             String?
  email_verified        Boolean?    @default(false)
  email_code            Int?
  requests              ApiRequest[]
  balance               Balance?
  user_settings         UserSettings?

  @@map("users")
}

model UserSettings {
    id                          Int         @id @default(autoincrement())
    user_id                     Int         @unique
    user                        User        @relation(fields: [user_id], references: [id])
    company_menu_open           Boolean     @default(true)
    prompt_pricing_visible      Boolean     @default(true)
    show_context_window_button  Boolean     @default(true)
    context_window              Int         @default(0)

    @@map("user_settings")
}

model Message {
  id                 Int       @id @default(autoincrement())
  prompt             String
  response           String
  pictures           Json?
  referencedMessages Message[] @relation("MessageReferences")
  referencedBy       Message[] @relation("MessageReferences")
  apiRequest         ApiRequest?

  @@map("messages")
}

model ApiRequest {
  id                Int         @id @default(autoincrement())
  user              User        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id           Int
  api_provider      ApiProvider
  api_model         ApiModel
  request_timestamp DateTime    @default(now())
  input_tokens      Int
  input_cost        Decimal     @db.Decimal(15, 10)
  output_tokens     Int
  output_cost       Decimal     @db.Decimal(15, 10)
  total_cost        Decimal     @db.Decimal(15, 10)
  message           Message?    @relation(fields: [message_id], references: [id])
  message_id        Int?        @unique

  @@map("api_requests")
}

model Balance {
  id      Int   @id @default(autoincrement())
  amount  Float @default(0)
  user    User  @relation(fields: [user_id], references: [id])
  user_id  Int   @unique

  @@map("balances")
}